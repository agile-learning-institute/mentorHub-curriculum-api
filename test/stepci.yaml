version: "1.1"
name: Curriculum API Check
env:
  host: localhost:8088
config:
  loadTest:
    phases:
      - duration: 5
        arrivalRate: 50

tests:
  observable:
    name: Test Observability
    steps:
      - name: GET Config Values
        http:
          url: http://${{env.host}}/api/config/
          method: GET
          check:
            status: /200/
            schema:
              type: object
              properties:
                api_version:
                  type: string
                config_items:
                  type: array
                versions:
                  type: array
                enumerators:
                  type: object
              required:
                - api_version
                - config_items
                - versions
                - enumerators
              additionalProperties: false
      - name: GET Health
        http:
          url: http://${{env.host}}/api/health/
          method: GET
          check:
            status: /200/

  paths:
    name: Test Path endpoints
    steps:
      - name: Get All Paths
        http:
          url: http://${{env.host}}/api/path
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            json.equals:
              - _id: "999900000000000000000000"
                name: The Odin Project
              - _id: "999900000000000000000001"
                name: EngineerKit
              - _id: "999900000000000000000002"
                name: Salesforce
              - _id: "999900000000000000000003"
                name: Cantrillo
              - _id: "999900000000000000000004"
                name: SRE Speciality
      - name: Get a Path
        http:
          url: http://${{env.host}}/api/path?query=SRE
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            json.equals:
              - _id: "999900000000000000000004"
                name: SRE Speciality
      - name: Get some Paths
        http:
          url: http://${{env.host}}/api/path?query=l
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            json.equals:
              - _id: "999900000000000000000002"
                name: Salesforce
              - _id: "999900000000000000000003"
                name: Cantrillo
              - _id: "999900000000000000000004"
                name: SRE Speciality

  topics:
    name: Test topic endpoints
    steps:
      - name: Get All Topics
        http:
          url: http://${{env.host}}/api/topic
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            json.equals:
              - _id: aaaa00000000000000000009
                name: Data Manipulation
              - _id: aaaa00000000000000000008
                name: Data Storage
              - _id: aaaa00000000000000000010
                name: Data Wrangling
              - _id: aaaa00000000000000000014
                name: GitBasics
              - _id: aaaa00000000000000000003
                name: Hardware
              - _id: aaaa00000000000000000002
                name: History of Computing
              - _id: aaaa00000000000000000016
                name: Intermediate CSS
              - _id: aaaa00000000000000000015
                name: Intermediate HTML
              - _id: aaaa00000000000000000011
                name: Managing State
              - _id: aaaa00000000000000000012
                name: OdinIntro
              - _id: aaaa00000000000000000004
                name: Operating Systems
              - _id: aaaa00000000000000000005
                name: Runtimes
              - _id: aaaa00000000000000000006
                name: Spectrum of Platforms
              - _id: aaaa00000000000000000007
                name: Types of Data
              - _id: aaaa00000000000000000013
                name: WebDevSetup
      - name: Get some Topics
        http:
          url: http://${{env.host}}/api/topic?query=data
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            json.equals:
              - _id: aaaa00000000000000000009
                name: Data Manipulation
              - _id: aaaa00000000000000000008
                name: Data Storage
              - _id: aaaa00000000000000000010
                name: Data Wrangling
              - _id: aaaa00000000000000000007
                name: Types of Data
      - name: Get a Topic
        http:
          url: http://${{env.host}}/api/topic/aaaa00000000000000000002
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            json.equals:
              - _id: aaaa00000000000000000009
                name: Data Manipulation
              - _id: aaaa00000000000000000008
                name: Data Storage
              - _id: aaaa00000000000000000010
                name: Data Wrangling
              - _id: aaaa00000000000000000014
                name: GitBasics
              - _id: aaaa00000000000000000003
                name: Hardware
              - _id: aaaa00000000000000000002
                name: History of Computing
              - _id: aaaa00000000000000000016
                name: Intermediate CSS
              - _id: aaaa00000000000000000015
                name: Intermediate HTML
              - _id: aaaa00000000000000000011
                name: Managing State
              - _id: aaaa00000000000000000012
                name: OdinIntro
              - _id: aaaa00000000000000000004
                name: Operating Systems
              - _id: aaaa00000000000000000005
                name: Runtimes
              - _id: aaaa00000000000000000006
                name: Spectrum of Platforms
              - _id: aaaa00000000000000000007
                name: Types of Data
              - _id: aaaa00000000000000000013
                name: WebDevSetup

  curriculum:
    name: Test get curriculum 
    steps:
      - name: GET an existing curriculum
        http:
          url: http://${{env.host}}/api/curriculum/aaaa00000000000000000001/
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            schema:
              type: object
              properties:
                _id:
                  type: string
                  value: aaaa00000000000000000001
                last_saved:
                  type: object
                  properties:
                    atTime:
                      type: string
                    byUser:
                      type: string
                    fromIp:
                      type: string
                    correlationId:
                      type: string
                resources: 
                  type: array
                  items:
                    type: object
                    properties:
                      sequence:
                        type: number
                      roadmap:
                        type: string
                      path:
                        type: string
                      segment:
                        type: string
                      topic:
                        type: string
                      type:
                        type: string
                      resourceid:
                        type: string
                      name:
                        type: string
                      link:
                        type: string
                      resource_name:
                        type: string
                      resource_url:
                        type: string
                      started:
                        type: string
                      completed:
                        type: string
                      rating:
                        type: number
                      review:
                        type: string

      - name: GET an new curriculum
        http:
          url: http://${{env.host}}/api/curriculum/aaaa00000000000000000002/
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            schema:
              type: object
              properties:
                _id:
                  type: string
                  value: aaaa00000000000000000002
                last_saved:
                  type: object
                  properties:
                    atTime:
                      type: string
                    byUser:
                      type: string
                    fromIp:
                      type: string
                    correlationId:
                      type: string
                resources: 
                  type: array
                  value: []

      - name: Add a Resource to a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/aaaa00000000000000000002/
          method: POST
          headers:
            Content-Type: application/json
          json: 
            sequence: 1
          check:
            status: /200/
            schema:
              type: object
              properties:
                _id:
                  type: string
                  value: aaaa00000000000000000002
                last_saved:
                  type: object
                  properties:
                    atTime:
                      type: string
                    byUser:
                      type: string
                    fromIp:
                      type: string
                    correlationId:
                      type: string
                resources: 
                  type: array
                  items:
                    type: object
                    properties:
                      sequence:
                        type: number
                        value: 1

      - name: Update a Resource in a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/aaaa00000000000000000002/1/
          method: PATCH
          headers:
            Content-Type: application/json
          json: 
            type: Adhoc
          check:
            status: /200/
            schema:
              type: object
              properties:
                _id:
                  type: string
                  value: aaaa00000000000000000002
                last_saved:
                  type: object
                  properties:
                    atTime:
                      type: string
                    byUser:
                      type: string
                    fromIp:
                      type: string
                    correlationId:
                      type: string
                resources: 
                  type: array
                  items:
                    type: object
                    properties:
                      sequence:
                        type: number
                        value: 1
                      type:
                        type: string
                        value: Adhoc

      - name: Remove a Resource from a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/aaaa00000000000000000002/1/
          method: DELETE
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            schema:
              type: object
              properties:
                _id:
                  type: string
                  value: aaaa00000000000000000002
                last_saved:
                  type: object
                  properties:
                    atTime:
                      type: string
                    byUser:
                      type: string
                    fromIp:
                      type: string
                    correlationId:
                      type: string
                resources: 
                  type: array
                  value: []

      - name: Remove testing Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/aaaa00000000000000000002/
          method: DELETE
          headers:
            Content-Type: application/json          
          check:
            status: /200/
    