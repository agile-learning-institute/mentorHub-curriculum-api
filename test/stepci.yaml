version: "1.1"
name: Curriculum API Check
env:
  host: localhost:8088
config:
  loadTest:
    phases:
      - duration: 5
        arrivalRate: 50

tests:
  observable:
    name: Test Observability
    steps:
      - name: GET Config Values
        http:
          url: http://${{env.host}}/api/config/
          method: GET
          check:
            status: /200/
            schema:
              type: object
              properties:
                api_version:
                  type: string
                config_items:
                  type: array
                versions:
                  type: array
                enumerators:
                  type: object
              required:
                - api_version
                - config_items
                - versions
                - enumerators
              additionalProperties: false
      - name: GET Health
        http:
          url: http://${{env.host}}/api/health/
          method: GET
          check:
            status: /200/

  curriculum_stubs:
    name: Test get curriculum Stubs
    steps:
      - name: GET an existing curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000001/
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            schema:
              type: object
              properties:
                method:
                  type: string
                  value: get_curriculum

      - name: Add a Resource to a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000001/
          method: POST
          headers:
            Content-Type: application/json
          json: 
            path: Test Path
          check:
            status: /200/
            schema:
              type: object
              properties:
                method:
                  type: string
                  value: create_curriculum

      - name: Update a Resource to a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000001/100/
          method: PATCH
          headers:
            Content-Type: application/json
          json: 
            path: Test Path
          check:
            status: /200/
            schema:
              type: object
              properties:
                method:
                  type: string
                  value: update_curriculum

      - name: Remove a Resource from a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000001/100/
          method: DELETE
          headers:
            Content-Type: application/json          
          check:
            status: /204/

  curriculum_test_data:
    name: Test get curriculum data
    steps:
      - name: GET an existing curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000001/
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            schema:
              type: object
              properties:
                _id:
                  type: string
                  value: AAAA00000000000000000001
                last_saved:
                  type: object
                  properties:
                    atTime:
                      type: string
                    byUser:
                      type: string
                    fromIp:
                      type: string
                    correlationId:
                      type: string
                resources: 
                  type: array
                  items:
                    type: object
                    properties:
                      sequence:
                        type: number
                      roadmap:
                        type: string
                      path:
                        type: string
                      segment:
                        type: string
                      topic:
                        type: string
                      type:
                        type: string
                      resourceid:
                        type: string
                      name:
                        type: string
                      link:
                        type: string
                      resource_name:
                        type: string
                      resource_url:
                        type: string
                      started:
                        type: string
                      completed:
                        type: string
                      rating:
                        type: number
                      review:
                        type: string

      - name: Create a new Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000111/
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            schema:
              type: object
              properties:
                _id:
                  type: string
                last_saved: 
                  type: object
                resources:  
                  type: array
                  minItems: 0
                  maxItems: 0
              required:
                _id
                last_saved
                resources

      - name: Add a Resource to a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000111/
          method: POST
          body:
            sequence: 100
            roadmap: Now
          headers:
            Content-Type: application/json
          json: 
            path: Test Path
          check:
            status: /200/
            schema:
              type: object
              properties:
                sequence:
                  type: number
                  value: 100
                roadmap:
                  type: string
                  value: Now
              required:
                sequence
                roadmap 

      - name: Update a Resource to a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000111/100/
          method: PATCH
          body:
            roadmap: Next
            path: Some Fancy Path
          headers:
            Content-Type: application/json
          json: 
            path: Test Path
          check:
            status: /200/
            schema:
              type: object
              properties:
                sequence:
                  type: number
                  value: 100
                roadmap:
                  type: string
                  value: Next
                path:
                  type: string
                  value: Some Fancy Path
              required:
                sequence
                roadmap 
                path

      - name: Remove a Resource from a Curriculum
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000111/100/
          method: DELETE
          headers:
            Content-Type: application/json          
          check:
            status: /204/

      - name: Verify Resource Removed
        http:
          url: http://${{env.host}}/api/curriculum/AAAA00000000000000000111/
          method: GET
          headers:
            Content-Type: application/json          
          check:
            status: /200/
            schema:
              type: object
              properties:
                _id:
                  type: string
                  value: AAAA00000000000000000111
                resources: 
                  type: array
                  minItems: 0
                  maxItems: 0
              required:
                _id
                resources 
